<div class="forgot-password-container">
  <div class="forgot-password-card">
    <!-- Header -->
    <div class="forgot-password-header">
      <div class="back-button" *ngIf="currentStep !== 'email'" (click)="goBackToEmail()">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Back
      </div>
      <h1 class="forgot-password-title">
        <span *ngIf="currentStep === 'email'">Forgot Password?</span>
        <span *ngIf="currentStep === 'reset'">Reset Password</span>
        <span *ngIf="currentStep === 'success'">Success!</span>
      </h1>
      <p class="forgot-password-subtitle">
        <span *ngIf="currentStep === 'email'">No worries! Enter your email and we'll send you a reset link.</span>
        <span *ngIf="currentStep === 'reset'">Enter your new password below.</span>
        <span *ngIf="currentStep === 'success'">Your password has been reset successfully!</span>
      </p>
    </div>

    <!-- Step Indicator -->
    <div class="step-indicator" *ngIf="currentStep !== 'success'">
      <div class="step" [class.active]="currentStep === 'email'" [class.completed]="currentStep === 'reset'">
        <div class="step-number">1</div>
        <div class="step-label">Enter Email</div>
      </div>
      <div class="step-line"></div>
      <div class="step" [class.active]="currentStep === 'reset'">
        <div class="step-number">2</div>
        <div class="step-label">Reset Password</div>
      </div>
    </div>

    <!-- Email Step -->
    <div class="forgot-password-content" *ngIf="currentStep === 'email'">
      <form class="forgot-password-form" (ngSubmit)="onSubmitEmail(emailForm)" #emailForm="ngForm">
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-wrapper">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input 
              type="email" 
              id="email" 
              name="email" 
              [(ngModel)]="resetData.email"
              (input)="onEmailChange()"
              placeholder="Enter your email address" 
              required
              email
              #emailInput="ngModel"
              [class.error]="(emailInput.invalid && emailInput.touched) || errors.email"
            >
          </div>
          <div class="error-message" *ngIf="(emailInput.invalid && emailInput.touched) || errors.email">
            <span *ngIf="emailInput.errors?.['required'] && emailInput.touched">Email is required</span>
            <span *ngIf="emailInput.errors?.['email'] && emailInput.touched">Please enter a valid email</span>
            <span *ngIf="errors.email">{{ errors.email }}</span>
          </div>
        </div>
        
        <button type="submit" class="submit-btn" [disabled]="emailForm.invalid || isLoading">
          <span *ngIf="!isLoading">Send Reset Link</span>
          <span *ngIf="isLoading" class="loading-spinner">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.3"/>
              <path d="M12 2A10 10 0 0 1 22 12" stroke="currentColor" stroke-width="4"/>
            </svg>
            Sending...
          </span>
        </button>
      </form>
    </div>

    <!-- Reset Password Step -->
    <div class="forgot-password-content" *ngIf="currentStep === 'reset'">
      <form class="forgot-password-form" (ngSubmit)="onSubmitReset(resetForm)" #resetForm="ngForm">
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <div class="input-wrapper">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
              <path d="M7 11V7A5 5 0 0 1 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input 
              [type]="showPassword ? 'text' : 'password'" 
              id="newPassword" 
              name="newPassword" 
              [(ngModel)]="resetData.newPassword"
              (input)="onNewPasswordChange()"
              placeholder="Enter new password" 
              required
              minlength="8"
              #newPasswordInput="ngModel"
              [class.error]="(newPasswordInput.invalid && newPasswordInput.touched) || errors.newPassword"
            >
            <button type="button" class="password-toggle" (click)="togglePassword('password')">
              <svg *ngIf="!showPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg *ngIf="showPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C5 20 1 12 1 12A18.45 18.45 0 0 1 5.06 5.06L17.94 17.94Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4C19 4 23 12 23 12A18.5 18.5 0 0 1 19.58 16.42L9.9 4.24Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div class="error-message" *ngIf="(newPasswordInput.invalid && newPasswordInput.touched) || errors.newPassword">
            <span *ngIf="newPasswordInput.errors?.['required'] && newPasswordInput.touched">New password is required</span>
            <span *ngIf="newPasswordInput.errors?.['minlength'] && newPasswordInput.touched">Password must be at least 8 characters</span>
            <span *ngIf="errors.newPassword">{{ errors.newPassword }}</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="input-wrapper">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
              <path d="M7 11V7A5 5 0 0 1 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'" 
              id="confirmPassword" 
              name="confirmPassword" 
              [(ngModel)]="resetData.confirmPassword"
              (input)="onConfirmPasswordChange()"
              placeholder="Confirm new password" 
              required
              #confirmPasswordInput="ngModel"
              [class.error]="(confirmPasswordInput.invalid && confirmPasswordInput.touched) || errors.confirmPassword"
            >
            <button type="button" class="password-toggle" (click)="togglePassword('confirm')">
              <svg *ngIf="!showConfirmPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg *ngIf="showConfirmPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C5 20 1 12 1 12A18.45 18.45 0 0 1 5.06 5.06L17.94 17.94Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4C19 4 23 12 23 12A18.5 18.5 0 0 1 19.58 16.42L9.9 4.24Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div class="error-message" *ngIf="(confirmPasswordInput.invalid && confirmPasswordInput.touched) || errors.confirmPassword">
            <span *ngIf="confirmPasswordInput.errors?.['required'] && confirmPasswordInput.touched">Please confirm your password</span>
            <span *ngIf="errors.confirmPassword">{{ errors.confirmPassword }}</span>
          </div>
        </div>
        
        <button type="submit" class="submit-btn" [disabled]="resetForm.invalid || isLoading">
          <span *ngIf="!isLoading">Reset Password</span>
          <span *ngIf="isLoading" class="loading-spinner">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.3"/>
              <path d="M12 2A10 10 0 0 1 22 12" stroke="currentColor" stroke-width="4"/>
            </svg>
            Resetting...
          </span>
        </button>
      </form>
    </div>

    <!-- Success Step -->
    <div class="forgot-password-content success-content" *ngIf="currentStep === 'success'">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 11.08V12A10 10 0 1 1 5.93 5.93" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      
      <h2 class="success-title">Password Reset Complete!</h2>
      <p class="success-message">
        <span *ngIf="resetData.email">We've sent a confirmation email to {{ resetData.email }}</span>
        <span *ngIf="!resetData.email">Your password has been successfully reset.</span>
        You can now sign in with your new password.
      </p>
      
      <div class="success-actions">
        <button class="success-btn primary" routerLink="/signin">
          Sign In Now
        </button>
        <button class="success-btn secondary" (click)="resendEmail()" *ngIf="resetData.email">
          Resend Email
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="forgot-password-footer">
      <p>Remember your password? <a routerLink="/signin" class="signin-link">Sign in here</a></p>
    </div>
  </div>
</div>
